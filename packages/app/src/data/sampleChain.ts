/**
 * Sample Chain Data for Testing
 * Demonstrates a 5-step chain with parallel execution
 */

import type { Chain } from '@afw/shared';
import { brandedTypes } from '@afw/shared';

export const sampleChain: Chain = {
  id: 'chain-sample-001',
  sessionId: brandedTypes.sessionId('session-001'),
  userId: brandedTypes.userId('user-001'),
  title: 'Code Review and Test Flow',
  source: 'composed',
  ref: 'composed-from: code + review + test',
  status: 'in_progress',
  compiledAt: brandedTypes.timestamp('2026-02-06T10:30:00Z'),
  startedAt: brandedTypes.timestamp('2026-02-06T10:31:00Z'),
  currentStep: brandedTypes.stepNumber(3),
  executionMode: 'mixed',
  steps: [
    {
      stepNumber: brandedTypes.stepNumber(1),
      action: 'code',
      model: 'haiku',
      status: 'completed',
      inputs: {
        Type: 'code-review',
        task: 'Implement login validation',
        context: 'backend/auth.py',
      },
      waitsFor: [],
      description: 'Implement the login validation feature',
      startedAt: brandedTypes.timestamp('2026-02-06T10:31:00Z'),
      completedAt: brandedTypes.timestamp('2026-02-06T10:35:30Z'),
      duration: 270000, // 4.5 minutes
      result: { filesModified: 2, linesAdded: 45 },
    },
    {
      stepNumber: brandedTypes.stepNumber(2),
      action: 'review',
      model: 'sonnet',
      status: 'completed',
      inputs: {
        scope: 'Step 1 output',
        context: 'backend/auth.py',
      },
      waitsFor: [brandedTypes.stepNumber(1)],
      description: 'Review the implemented code for quality and security',
      startedAt: brandedTypes.timestamp('2026-02-06T10:36:00Z'),
      completedAt: brandedTypes.timestamp('2026-02-06T10:38:45Z'),
      duration: 165000, // 2.75 minutes
      result: { issues: 1, suggestions: 3 },
    },
    {
      stepNumber: brandedTypes.stepNumber(3),
      action: 'test',
      model: 'haiku',
      status: 'in_progress',
      inputs: {
        component: 'backend',
        type: 'unit',
      },
      waitsFor: [brandedTypes.stepNumber(1)],
      description: 'Run unit tests for the new feature',
      startedAt: brandedTypes.timestamp('2026-02-06T10:36:15Z'),
    },
    {
      stepNumber: brandedTypes.stepNumber(4),
      action: 'test',
      model: 'haiku',
      status: 'pending',
      inputs: {
        component: 'backend',
        type: 'integration',
      },
      waitsFor: [brandedTypes.stepNumber(1)],
      description: 'Run integration tests for the new feature',
    },
    {
      stepNumber: brandedTypes.stepNumber(5),
      action: 'commit',
      model: 'haiku',
      status: 'pending',
      inputs: {
        message: 'feat: Add login validation',
        scope: 'backend/auth',
      },
      waitsFor: [
        brandedTypes.stepNumber(2),
        brandedTypes.stepNumber(3),
        brandedTypes.stepNumber(4),
      ],
      description: 'Commit the changes and push to remote',
    },
  ],
  successfulSteps: 2,
  failedSteps: 0,
  skippedSteps: 0,
  summary: 'Code implementation and review in progress, tests pending',
};

/**
 * Alternative sample chains for testing different scenarios
 */

export const sequentialChain: Chain = {
  id: 'chain-sequential-001',
  sessionId: brandedTypes.sessionId('session-002'),
  userId: brandedTypes.userId('user-001'),
  title: 'Sequential Deployment Pipeline',
  source: 'flow',
  ref: 'deployment-flow',
  status: 'completed',
  compiledAt: brandedTypes.timestamp('2026-02-06T09:00:00Z'),
  startedAt: brandedTypes.timestamp('2026-02-06T09:05:00Z'),
  completedAt: brandedTypes.timestamp('2026-02-06T09:35:00Z'),
  duration: brandedTypes.duration.ms(1800000),
  executionMode: 'sequential',
  steps: [
    {
      stepNumber: brandedTypes.stepNumber(1),
      action: 'test',
      model: 'haiku',
      status: 'completed',
      inputs: { Type: 'test', scope: 'all' },
      waitsFor: [],
      startedAt: brandedTypes.timestamp('2026-02-06T09:05:00Z'),
      completedAt: brandedTypes.timestamp('2026-02-06T09:12:00Z'),
      duration: brandedTypes.duration.ms(420000),
      result: { passed: 152, failed: 0 },
    },
    {
      stepNumber: brandedTypes.stepNumber(2),
      action: 'audit',
      model: 'sonnet',
      status: 'completed',
      inputs: { aspect: 'security' },
      waitsFor: [brandedTypes.stepNumber(1)],
      startedAt: brandedTypes.timestamp('2026-02-06T09:12:30Z'),
      completedAt: brandedTypes.timestamp('2026-02-06T09:18:00Z'),
      duration: brandedTypes.duration.ms(330000),
      result: { findings: [] },
    },
    {
      stepNumber: brandedTypes.stepNumber(3),
      action: 'commit',
      model: 'haiku',
      status: 'completed',
      inputs: { message: 'chore: Release v2.1.0' },
      waitsFor: [brandedTypes.stepNumber(2)],
      startedAt: brandedTypes.timestamp('2026-02-06T09:18:30Z'),
      completedAt: brandedTypes.timestamp('2026-02-06T09:20:00Z'),
      duration: brandedTypes.duration.ms(90000),
    },
    {
      stepNumber: brandedTypes.stepNumber(4),
      action: 'notify',
      model: 'haiku',
      status: 'completed',
      inputs: { channel: '#deployments', message: 'Release deployed' },
      waitsFor: [brandedTypes.stepNumber(3)],
      startedAt: brandedTypes.timestamp('2026-02-06T09:20:30Z'),
      completedAt: brandedTypes.timestamp('2026-02-06T09:21:00Z'),
      duration: brandedTypes.duration.ms(30000),
    },
  ],
  successfulSteps: 4,
  failedSteps: 0,
  skippedSteps: 0,
  summary: 'Deployment completed successfully',
};

export const complexParallelChain: Chain = {
  id: 'chain-complex-001',
  sessionId: brandedTypes.sessionId('session-003'),
  userId: brandedTypes.userId('user-001'),
  title: 'Comprehensive Audit and Fix Pipeline',
  source: 'composed',
  ref: 'composed-from: audit + analyze + code + review + test + commit + notify',
  status: 'mixed',
  compiledAt: brandedTypes.timestamp('2026-02-06T08:00:00Z'),
  startedAt: brandedTypes.timestamp('2026-02-06T08:05:00Z'),
  executionMode: 'mixed',
  steps: [
    // Initial parallel audits
    {
      stepNumber: brandedTypes.stepNumber(1),
      action: 'audit',
      model: 'sonnet',
      status: 'completed',
      inputs: { Type: 'audit', aspect: 'security', scope: 'backend' },
      waitsFor: [],
      startedAt: brandedTypes.timestamp('2026-02-06T08:05:00Z'),
      completedAt: brandedTypes.timestamp('2026-02-06T08:12:00Z'),
      duration: brandedTypes.duration.ms(420000),
    },
    {
      stepNumber: brandedTypes.stepNumber(2),
      action: 'audit',
      model: 'sonnet',
      status: 'completed',
      inputs: { aspect: 'performance', scope: 'frontend' },
      waitsFor: [],
      startedAt: brandedTypes.timestamp('2026-02-06T08:05:00Z'),
      completedAt: brandedTypes.timestamp('2026-02-06T08:14:00Z'),
      duration: brandedTypes.duration.ms(540000),
    },
    {
      stepNumber: brandedTypes.stepNumber(3),
      action: 'analyze',
      model: 'opus',
      status: 'completed',
      inputs: { type: 'coverage', component: 'all' },
      waitsFor: [],
      startedAt: brandedTypes.timestamp('2026-02-06T08:05:00Z'),
      completedAt: brandedTypes.timestamp('2026-02-06T08:10:00Z'),
      duration: brandedTypes.duration.ms(300000),
    },

    // Fixes based on findings
    {
      stepNumber: brandedTypes.stepNumber(4),
      action: 'code',
      model: 'opus',
      status: 'in_progress',
      inputs: { task: 'Fix security vulnerabilities', context: 'Step 1' },
      waitsFor: [brandedTypes.stepNumber(1)],
      startedAt: brandedTypes.timestamp('2026-02-06T08:14:30Z'),
    },
    {
      stepNumber: brandedTypes.stepNumber(5),
      action: 'code',
      model: 'opus',
      status: 'pending',
      inputs: { task: 'Improve performance', context: 'Step 2' },
      waitsFor: [brandedTypes.stepNumber(2)],
    },
    {
      stepNumber: brandedTypes.stepNumber(6),
      action: 'test',
      model: 'haiku',
      status: 'pending',
      inputs: { scope: 'coverage', threshold: 80 },
      waitsFor: [brandedTypes.stepNumber(3)],
    },

    // Validation
    {
      stepNumber: brandedTypes.stepNumber(7),
      action: 'review',
      model: 'sonnet',
      status: 'pending',
      inputs: { scope: 'Steps 4-6' },
      waitsFor: [
        brandedTypes.stepNumber(4),
        brandedTypes.stepNumber(5),
        brandedTypes.stepNumber(6),
      ],
    },

    // Finalization
    {
      stepNumber: brandedTypes.stepNumber(8),
      action: 'commit',
      model: 'haiku',
      status: 'pending',
      inputs: { message: 'fix: Address audit findings' },
      waitsFor: [brandedTypes.stepNumber(7)],
    },
    {
      stepNumber: brandedTypes.stepNumber(9),
      action: 'notify',
      model: 'haiku',
      status: 'pending',
      inputs: { channel: '#dev', summary: 'Audit fixes completed' },
      waitsFor: [brandedTypes.stepNumber(8)],
    },
  ],
  successfulSteps: 3,
  failedSteps: 0,
  skippedSteps: 0,
  summary: 'Security and performance audits underway, fixes in progress',
};

/**
 * OpenSpec chain example with explicit Type field
 */
export const openspecChain: Chain = {
  id: 'chain-openspec-001',
  sessionId: brandedTypes.sessionId('session-004'),
  userId: brandedTypes.userId('user-001'),
  title: 'OpenSpec: Feature Architecture Review',
  source: 'composed',
  ref: 'composed-from: openspec-propose + openspec-apply',
  status: 'in_progress',
  compiledAt: brandedTypes.timestamp('2026-02-06T11:00:00Z'),
  startedAt: brandedTypes.timestamp('2026-02-06T11:05:00Z'),
  currentStep: brandedTypes.stepNumber(2),
  executionMode: 'sequential',
  steps: [
    {
      stepNumber: brandedTypes.stepNumber(1),
      action: 'openspec-propose',
      model: 'opus',
      status: 'completed',
      inputs: {
        Type: 'openspec',
        proposal: 'Multi-tenant caching strategy',
        scope: 'backend/cache',
      },
      waitsFor: [],
      description: 'Create an OpenSpec proposal for review',
      startedAt: brandedTypes.timestamp('2026-02-06T11:05:00Z'),
      completedAt: brandedTypes.timestamp('2026-02-06T11:15:30Z'),
      duration: brandedTypes.duration.ms(630000),
      result: { proposal_id: 'CHANGE-2847', status: 'approved' },
    },
    {
      stepNumber: brandedTypes.stepNumber(2),
      action: 'openspec-apply',
      model: 'opus',
      status: 'in_progress',
      inputs: {
        changeId: 'CHANGE-2847',
        proposal_id: 'CHANGE-2847',
        scope: 'backend/cache',
      },
      waitsFor: [brandedTypes.stepNumber(1)],
      description: 'Apply the approved OpenSpec changes',
      startedAt: brandedTypes.timestamp('2026-02-06T11:16:00Z'),
    },
    {
      stepNumber: brandedTypes.stepNumber(3),
      action: 'review',
      model: 'sonnet',
      status: 'pending',
      inputs: { scope: 'Step 2 output', focus: 'implementation quality' },
      waitsFor: [brandedTypes.stepNumber(2)],
      description: 'Review the applied changes',
    },
    {
      stepNumber: brandedTypes.stepNumber(4),
      action: 'test',
      model: 'haiku',
      status: 'pending',
      inputs: { component: 'backend', type: 'integration' },
      waitsFor: [brandedTypes.stepNumber(2)],
      description: 'Run integration tests for cache layer',
    },
    {
      stepNumber: brandedTypes.stepNumber(5),
      action: 'commit',
      model: 'haiku',
      status: 'pending',
      inputs: { message: 'feat: Implement multi-tenant cache strategy' },
      waitsFor: [brandedTypes.stepNumber(3), brandedTypes.stepNumber(4)],
      description: 'Commit approved changes',
    },
  ],
  successfulSteps: 1,
  failedSteps: 0,
  skippedSteps: 0,
  summary: 'OpenSpec proposal approved and changes being applied',
};
